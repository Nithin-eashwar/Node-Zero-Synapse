# ğŸš€ How to Run Synapse (Node-Zero)

This guide provides step-by-step instructions to set up, index, and run the Synapse backend engine.

## ğŸ“‹ Prerequisites
- **Python 3.10+** (Recommend 3.12)
- **Git**

---

## ğŸ› ï¸ 1. Environmental Setup

### Create Virtual Environment
```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# Linux/Mac
python3 -m venv .venv
source .venv/bin/activate
```

### Install Dependencies
```bash
pip install -r requirements.txt
```

### Configure Environment Variables
Create a `.env` file in the root directory:
```env
# .env
GOOGLE_API_KEY=your_gemini_api_key_here
```
*(Get a key from [Google AI Studio](https://aistudio.google.com/app/apikey))*

---

## ğŸ§  2. Data Initialization (Crucial Step)

Synapse relies on two layers of data:
1.  **Code Graph** (`repo_graph.json`): Generated by parsing the source code.
2.  **Vector Index** (`chroma_db/`): Generated from the Code Graph for AI search.

### Step 2.1: Parse Codebase
This scans your project and builds the dependency graph.
```bash
# Parse the current directory and generate repo_graph.json
python -m backend.parsing.parser .

# (Optional) To analyze a different project:
python -m backend.parsing.parser <path_to_project>
```
*Output: `[SAVE] Database saved to: repo_graph.json`*

### Step 2.2: Index for AI (Vector Store)
This embeds the code graph into ChromaDB so the AI can answer questions.
```bash
# Generate embeddings and store in ChromaDB
python scripts/index_codebase.py
```
*Output: `SUCCESS: Indexed X items into ChromaDB.`*

---

## â–¶ï¸ 3. Run the Server

Start the backend API using Uvicorn:

```bash
python -m uvicorn backend.api.main:app --reload
```

- **API URL**: `http://127.0.0.1:8000`
- **Swagger UI**: `http://127.0.0.1:8000/docs`

---

## âœ… 4. Verification

To verify everything is working correctly:

### Check Health
Visit: `http://127.0.0.1:8000/`
*Should return: `{"status": "active", ...}`*

### Test AI Query
Visit: `http://127.0.0.1:8000/docs` -> **GET /ai/ask**
- **Query**: "How does the blast radius work?"
- **Execute**
*Should return a detailed answer explaining `calculate_blast_radius`.*

---

## ğŸ› Troubleshooting

| Issue | Solution |
|-------|----------|
| **Graph is empty or missing** | Run **Step 2.1** (`parser.py`) again. Ensure `repo_graph.json` exists in root. |
| **AI gives generic answers** | Run **Step 2.2** (`index_codebase.py`) again to update the vector store. |
| **500 Error on /ai/index** | Use the offline script `python scripts/index_codebase.py` instead of the API endpoint. |
| **UnicodeEncodeError** | Initial setup script (`verify_full_flow.py`) had emojis; use the updated version or rely on these manual steps. |
